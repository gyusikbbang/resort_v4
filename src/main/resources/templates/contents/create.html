<!DOCTYPE html>

<html layout:decorate="~{layout}"><!-- layout.html 상속-->
<div layout:fragment="content">

  <div th:each="cateVO : ${cateVO}" >

  <div  th:if="${cateVO.namesub == null}" class='title_line'><span  style="font-size: 20px;"  th:text="@{|전체  > 글등록 |}"></span></div>
    <div   th:if="${cateVO.namesub != null}" class='title_line'><span style="font-size: 20px;"  th:text="@{|${cateVO.namesub} > 글등록 |}"></span></div>

  <aside class="aside_right">
    <a th:href="@{|./create?cateno=${cateVO.cateno}|}">등록</a>
    <span class='menu_divide'>│</span>
    <a href="javascript:location.reload();">새로고침</a>
    <span class='menu_divide'>│</span>
    <a th:href="@{|./list_by_cateno_search_paging.do?cateno=${cateVO.cateno}|}">기본 목록형</a>
    <span class='menu_divide'>│</span>
    <a th:href="@{|./list_by_cateno_grid.do?cateno=${cateVO.cateno}|}">갤러리형</a>
  </aside>



  <div class='menu_line'></div>

  <form name='frm' method='post' action='./create' enctype="multipart/form-data">
    <input type="hidden"  th:if="${cateno != 0}" name="cateno" th:value="${cateno}"  >
    <select th:if="${cateno == 0 }" id="categorySelect" name="category" onchange="changeSubCategory(this)">
      <option value="">카테고리 선택</option>
      <!-- Thymeleaf 반복문 사용 -->
      <option th:each="category : ${catelist}"
              th:value="${category.name}"
              th:data-cateno="${category.cateno}" th:text="${category.name}">
      </option>
    </select>

    <!-- 두 번째 셀렉트 박스 -->
    <select th:if="${cateno == 0 }"  id="subCategorySelect" name="cateno">
      <option value="">하위 카테고리 선택</option>
    </select>

    <script th:inline="javascript" >
      // 하위 카테고리 셀렉트 박스 값 변경 시 실행되는 함수
      function changeSubCategory() {
        var selectElement = document.getElementById("categorySelect");
        var selectedOption = selectElement.options[selectElement.selectedIndex];
        var selectedValue = selectedOption.value;
        var selectedCateno = selectedOption.getAttribute("data-cateno"); // 데이터 속성에서 cateno 가져오기

        // 서버로부터 하위 카테고리 리스트 가져오는 요청을 보냄
        if (selectedCateno !== "0") { // cateno가 0이 아닌 경우에만 요청 보냄
          fetch("/contents/getSubCategories?name=" + encodeURIComponent(selectedValue)) // encodeURIComponent를 사용하여 URL 파라미터 인코딩
            .then(response => response.json())
            .then(data => {
              // 기존의 하위 카테고리 리스트를 초기화
              var subCategorySelect = document.getElementById("subCategorySelect");
              subCategorySelect.innerHTML = "";

              // 새로운 하위 카테고리 리스트 추가
              data.forEach(subCategory => {
                var option = document.createElement("option");
                option.value = subCategory.cateno;
                option.text = subCategory.namesub;
                subCategorySelect.appendChild(option);
              });
            });
        } else { // cateno가 0이면 두 번째 셀렉트 박스를 비활성화
          var subCategorySelect = document.getElementById("subCategorySelect");
          subCategorySelect.innerHTML = ""; // 기존 옵션 제거
          var disabledOption = document.createElement("option");
          disabledOption.value = "";
          disabledOption.text = "하위 카테고리 선택";
          disabledOption.disabled = true; // 비활성화
          subCategorySelect.appendChild(disabledOption);
        }
      }
    </script>

    <div>
      <label>제목</label>
      <input type='text' name='title' value='주말 오지 탐험' required="required"
             autofocus="autofocus" class="form-control" style='width: 100%;'>
    </div>
    <div>
      <label>내용</label>
      <textarea name='content' required="required" class="form-control" rows="12" style='width: 100%;'>오지 탐험은 언제나 즐거운 시간이었어요! </textarea>
    </div>
    <div>
      <label>검색어</label>
      <input type='text' name='word' value='오버랜딩,오지,탐험,일상탈피,힐링,내공,추진력,문제해결' required="required"
             class="form-control" style='width: 100%;'>
    </div>
    <div>
      <label>이미지</label>
      <input type='file' class="form-control" name='file1MF' id='file1MF' value='' placeholder="파일 선택">
    </div>
    <div>
      <label>패스워드</label>
      <input type='password' name='passwd' value='1234' required="required"
             class="form-control" style='width: 50%;'>
    </div>
    <div class="content_body_bottom">
      <button type="submit" class="btn btn-secondary btn-sm">등록</button>
      <button type="button" th:onclick="'|javascript:location.href=\'./list_by_cateno_search_paging.do?cateno=${param.cateno}\'|'"

              class="btn btn-secondary btn-sm">목록
      </button>
    </div>

  </form>

  </div>
</div>